### 分布式事务
 - 1.本地消息表
 
 一起成功以及一起失败。
 分布式事务是两个不同系统的事务同时成功或者失败。
 那么我聊天的这种情况还需要使用分布式事务吗。
 
 本地消息逻辑和插入消息为一个逻辑，然后如果失败了就回滚就都失败了。
 如果成功了到达第二个部分然后成功看消息成功消费了没有，没有成功消费就重试，
 重试三次后记录原因
 
 - 2.rocketmq事务消息
 
 
 
 一个生产开发过程中更常用的解决方案是本地事务中先写库持久化，
 异步发送消息（非事务消息），消息消费者端做好幂等，消息可重试。
 若消费失败进行重试，若一直失败则会进入死信队列。这样保证最终一致性
 （真实生产环境中要求实时一致性的场景并不是太多）
 
 - 3.项目如何操作 ，需要解决的问题
  如何解决消息重试的问题，如何保证发送消息是幂等的。
  
### 目前消息系统存在的问题
1.多端同时收到消息的问题。如何允许多端登录
2.消息的有序性，不同人发送消息 然后显示的顺序 不一样，
消息一致性。这个发送消息不一样

，用户问A问题后又问题了B问题，在客服侧B问题排到A问题的前面，
导致客服的回复也出现了错乱。当然这只是IM消息乱序的一种场景而已。
诸如此类的还有很多。消息乱序产生的原因有很多，例如发送文件后再立即发送消息，
文件需要前端先上传到OSS获取到URL后再发送给用户，上传文件这个过程，用户以及
客服都是可以发送消息的，这种场景处理不好就极易出现消息乱序。

作者：得物技术

  
  
  消息可靠  
  消息实时性
  消息有序
  消息幂等
  
  
  既然要保证消息的可靠性，消息的重复就是无法避免的。就有可能出现消息幂等性问题。那怎么解决呢？我们是利用消息的Message ID做去重的，这里会涉及到一个性能问题，排序、去重以及风控信息验证等都需要一定的计算成本，如何保证处理过程系统不卡顿是一个核心问题。想要了解我们客服IM是如何做的，请继续向下看。
 
  
  

